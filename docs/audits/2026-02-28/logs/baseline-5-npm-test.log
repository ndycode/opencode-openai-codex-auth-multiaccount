
> oc-chatgpt-multi-auth@5.4.0 test
> vitest run


 RUN  v4.0.18 C:/Users/neil/DevTools/oc-chatgpt-multi-auth-audit-20260228-111254

 ✓ test/tool-utils.test.ts (30 tests) 7ms
 ✓ test/input-utils.test.ts (32 tests) 20ms
 ✓ test/refresh-queue.test.ts (24 tests) 11ms
stdout | test/logger.test.ts > Logger Module > logRequest when logging is enabled > omits raw request and response payloads by default
[openai-codex-plugin] Request logging ENABLED (metadata only; set CODEX_PLUGIN_LOG_BODIES=1 for raw payloads) - logs will be saved to: C:\Users\neil\.opencode\logs\codex-plugin

 ✓ test/proactive-refresh.test.ts (27 tests) 14ms
 ✓ test/codex-prompts.test.ts (28 tests) 13ms
 ✓ test/rotation.test.ts (43 tests) 19ms
 ✓ test/server.unit.test.ts (13 tests) 69ms
stdout | test/logger.test.ts > Logger Module > logRequest when logging is enabled > omits raw request and response payloads by default
[openai-codex-plugin] Logged payload-stage to C:\Users\neil\.opencode\logs\codex-plugin\request-1-payload-stage.json

stdout | test/logger.test.ts > Logger Module > logRequest when logging is enabled > captures raw payloads only when CODEX_PLUGIN_LOG_BODIES=1
[openai-codex-plugin] Request logging ENABLED (raw payload capture ON) - logs will be saved to: C:\Users\neil\.opencode\logs\codex-plugin

stdout | test/logger.test.ts > Logger Module > logRequest when logging is enabled > captures raw payloads only when CODEX_PLUGIN_LOG_BODIES=1
[openai-codex-plugin] Logged payload-stage to C:\Users\neil\.opencode\logs\codex-plugin\request-1-payload-stage.json

stdout | test/logger.test.ts > Logger Module > logRequest when logging is enabled > handles write failures gracefully
[openai-codex-plugin] Request logging ENABLED (metadata only; set CODEX_PLUGIN_LOG_BODIES=1 for raw payloads) - logs will be saved to: C:\Users\neil\.opencode\logs\codex-plugin

 ✓ test/recovery.test.ts (73 tests) 31ms
 ✓ test/logger.test.ts (85 tests) 58ms
 ✓ test/recovery-storage.test.ts (45 tests) 164ms
 ✓ test/token-utils.test.ts (90 tests) 23ms
 ✓ test/opencode-codex.test.ts (13 tests) 28ms
 ✓ test/response-handler.test.ts (30 tests) 61ms
 ✓ test/cli.test.ts (38 tests) 428ms
       ✓ returns true for 'y' input  382ms
 ✓ test/browser.test.ts (21 tests) 10ms
 ✓ test/auto-update-checker.test.ts (18 tests) 44ms
 ✓ test/errors.test.ts (33 tests) 14ms
 ✓ test/model-map.test.ts (22 tests) 7ms
 ✓ test/circuit-breaker.test.ts (23 tests) 12ms
stdout | test/index.test.ts > OpenAIOAuthPlugin persistAccountPool > preserves flagged organization identity during verify-flagged restore for cached and refreshed paths

Verifying flagged accounts...


stdout | test/index.test.ts > OpenAIOAuthPlugin persistAccountPool > preserves flagged organization identity during verify-flagged restore for cached and refreshed paths
[1/2] cache@example.com: RESTORED (Codex CLI cache)

stdout | test/index.test.ts > OpenAIOAuthPlugin persistAccountPool > preserves flagged organization identity during verify-flagged restore for cached and refreshed paths
[2/2] refresh@example.com: RESTORED

stdout | test/index.test.ts > OpenAIOAuthPlugin persistAccountPool > preserves flagged organization identity during verify-flagged restore for cached and refreshed paths

Results: 2 restored, 0 still flagged


 ✓ test/index.test.ts (106 tests) 487ms
       ✓ exports event handler  399ms
 ✓ test/paths.test.ts (28 tests) 12ms
 ✓ test/audit.test.ts (17 tests) 90ms
 ✓ test/config.test.ts (20 tests) 4ms
 ✓ test/auth-rate-limit.test.ts (22 tests) 11ms
 ✓ test/health.test.ts (13 tests) 11ms
 ✓ test/codex.test.ts (32 tests) 6ms
 ✓ test/context-overflow.test.ts (21 tests) 29ms
 ✓ test/rate-limit-backoff.test.ts (21 tests) 8ms
 ✓ test/shutdown.test.ts (11 tests) 76ms
 ✓ test/parallel-probe.test.ts (15 tests) 232ms
 ✓ test/utils.test.ts (24 tests) 18ms
 ✓ test/beginner-ui.test.ts (12 tests) 4ms
 ✓ test/recovery-constants.test.ts (7 tests) 9ms
 ✓ test/table-formatter.test.ts (8 tests) 4ms
 ✓ test/auth-menu.test.ts (2 tests) 6ms
 ✓ test/ui-format.test.ts (4 tests) 4ms
 ✓ test/retry-budget.test.ts (4 tests) 3ms
 ✓ test/oauth-server.integration.test.ts (5 tests) 60ms
 ✓ test/ui-theme.test.ts (5 tests) 4ms
 ✓ test/ui-runtime.test.ts (3 tests) 3ms
 ✓ test/plugin-config.test.ts (61 tests) 23ms
 ✓ test/schemas.test.ts (60 tests) 26ms
 ✓ test/auth.test.ts (41 tests) 21ms
 ✓ test/index-retry.test.ts (1 test) 336ms
     ✓ waits and retries when all accounts are rate-limited  335ms
 ✓ test/storage-async.test.ts (23 tests) 30ms
 ✓ test/rotation-integration.test.ts (21 tests) 23ms
 ✓ test/accounts.test.ts (99 tests) 20ms
 ✓ test/copy-oauth-success.test.ts (2 tests) 33ms
 ✓ test/audit.race.test.ts (1 test) 162ms
 ✓ test/property/setup.test.ts (3 tests) 8ms
 ✓ test/property/transformer.property.test.ts (17 tests) 35ms
 ✓ test/property/rotation.property.test.ts (16 tests) 67ms
 ✓ test/storage.test.ts (94 tests) 1312ms
       ✓ returns migrated data even when save fails (line 422-423 coverage)  366ms
       ✓ throws after 5 failed EPERM retries  503ms
 ✓ test/chaos/fault-injection.test.ts (43 tests) 58ms
 ✓ test/fetch-helpers.test.ts (73 tests) 1729ms
       ✓ transforms request when parsedBody is provided even if init.body is not a string  1688ms
 ✓ test/request-transformer.test.ts (153 tests) 8635ms
       ✓ preserves existing prompt_cache_key passed by host (OpenCode)  2357ms

 Test Files  56 passed (56)
      Tests  1776 passed (1776)
   Start at  11:14:37
   Duration  9.84s (transform 8.73s, setup 0ms, import 24.66s, tests 14.63s, environment 6ms)

