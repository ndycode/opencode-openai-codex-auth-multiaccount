
> oc-chatgpt-multi-auth@5.4.0 coverage
> vitest run --coverage


 RUN  v4.0.18 C:/Users/neil/DevTools/oc-chatgpt-multi-auth-audit-20260228-111254
      Coverage enabled with v8

 ✓ test/shutdown.test.ts (11 tests) 66ms
 ✓ test/copy-oauth-success.test.ts (2 tests) 83ms
 ✓ test/opencode-codex.test.ts (13 tests) 133ms
 ✓ test/auto-update-checker.test.ts (18 tests) 123ms
stdout | test/logger.test.ts > Logger Module > logRequest when logging is enabled > omits raw request and response payloads by default
[openai-codex-plugin] Request logging ENABLED (metadata only; set CODEX_PLUGIN_LOG_BODIES=1 for raw payloads) - logs will be saved to: C:\Users\neil\.opencode\logs\codex-plugin

stdout | test/logger.test.ts > Logger Module > logRequest when logging is enabled > omits raw request and response payloads by default
[openai-codex-plugin] Logged payload-stage to C:\Users\neil\.opencode\logs\codex-plugin\request-1-payload-stage.json

stdout | test/logger.test.ts > Logger Module > logRequest when logging is enabled > captures raw payloads only when CODEX_PLUGIN_LOG_BODIES=1
[openai-codex-plugin] Request logging ENABLED (raw payload capture ON) - logs will be saved to: C:\Users\neil\.opencode\logs\codex-plugin

stdout | test/logger.test.ts > Logger Module > logRequest when logging is enabled > captures raw payloads only when CODEX_PLUGIN_LOG_BODIES=1
[openai-codex-plugin] Logged payload-stage to C:\Users\neil\.opencode\logs\codex-plugin\request-1-payload-stage.json

stdout | test/logger.test.ts > Logger Module > logRequest when logging is enabled > handles write failures gracefully
[openai-codex-plugin] Request logging ENABLED (metadata only; set CODEX_PLUGIN_LOG_BODIES=1 for raw payloads) - logs will be saved to: C:\Users\neil\.opencode\logs\codex-plugin

 ✓ test/recovery-storage.test.ts (45 tests) 153ms
 ✓ test/server.unit.test.ts (13 tests) 64ms
 ✓ test/logger.test.ts (85 tests) 68ms
 ✓ test/response-handler.test.ts (30 tests) 70ms
 ✓ test/oauth-server.integration.test.ts (5 tests) 76ms
 ✓ test/audit.test.ts (17 tests) 99ms
 ✓ test/audit.race.test.ts (1 test) 161ms
 ✓ test/storage-async.test.ts (23 tests) 47ms
 ✓ test/property/rotation.property.test.ts (16 tests) 132ms
 ✓ test/cli.test.ts (38 tests) 470ms
       ✓ returns true for 'y' input  417ms
 ✓ test/property/transformer.property.test.ts (17 tests) 72ms
 ✓ test/parallel-probe.test.ts (15 tests) 245ms
 ✓ test/context-overflow.test.ts (21 tests) 32ms
 ✓ test/input-utils.test.ts (32 tests) 24ms
 ✓ test/rotation.test.ts (43 tests) 30ms
 ✓ test/utils.test.ts (24 tests) 20ms
 ✓ test/rotation-integration.test.ts (21 tests) 53ms
 ✓ test/recovery.test.ts (73 tests) 33ms
 ✓ test/chaos/fault-injection.test.ts (43 tests) 79ms
 ✓ test/plugin-config.test.ts (61 tests) 28ms
 ✓ test/schemas.test.ts (60 tests) 23ms
 ✓ test/token-utils.test.ts (90 tests) 22ms
 ✓ test/fetch-helpers.test.ts (77 tests) 226ms
 ✓ test/proactive-refresh.test.ts (27 tests) 16ms
 ✓ test/index-retry.test.ts (1 test) 816ms
     ✓ waits and retries when all accounts are rate-limited  815ms
 ✓ test/auth.test.ts (42 tests) 40ms
 ✓ test/accounts.test.ts (99 tests) 28ms
 ✓ test/rate-limit-backoff.test.ts (21 tests) 12ms
stdout | test/index.test.ts > OpenAIOAuthPlugin persistAccountPool > preserves flagged organization identity during verify-flagged restore for cached and refreshed paths

Verifying flagged accounts...


stdout | test/index.test.ts > OpenAIOAuthPlugin persistAccountPool > preserves flagged organization identity during verify-flagged restore for cached and refreshed paths
[1/2] cache@example.com: RESTORED (Codex CLI cache)

stdout | test/index.test.ts > OpenAIOAuthPlugin persistAccountPool > preserves flagged organization identity during verify-flagged restore for cached and refreshed paths
[2/2] refresh@example.com: RESTORED

stdout | test/index.test.ts > OpenAIOAuthPlugin persistAccountPool > preserves flagged organization identity during verify-flagged restore for cached and refreshed paths

Results: 2 restored, 0 still flagged


 ✓ test/codex-prompts.test.ts (28 tests) 23ms
 ✓ test/index.test.ts (106 tests) 788ms
       ✓ exports event handler  683ms
 ✓ test/ui-select.test.ts (6 tests) 12ms
 ✓ test/refresh-queue.test.ts (24 tests) 13ms
 ✓ test/circuit-breaker.test.ts (23 tests) 14ms
 ✓ test/browser.test.ts (21 tests) 11ms
 ✓ test/auth-rate-limit.test.ts (22 tests) 12ms
 ✓ test/recovery-constants.test.ts (7 tests) 8ms
 ✓ test/errors.test.ts (33 tests) 12ms
 ✓ test/paths.test.ts (28 tests) 11ms
 ✓ test/model-map.test.ts (22 tests) 7ms
 ✓ test/health.test.ts (13 tests) 12ms
 ✓ test/tool-utils.test.ts (30 tests) 7ms
 ✓ test/auth-menu.test.ts (2 tests) 7ms
 ✓ test/config.test.ts (20 tests) 6ms
 ✓ test/table-formatter.test.ts (8 tests) 4ms
 ✓ test/codex.test.ts (32 tests) 6ms
 ✓ test/ui-theme.test.ts (5 tests) 5ms
 ✓ test/ui-confirm.test.ts (3 tests) 6ms
 ✓ test/ui-format.test.ts (4 tests) 4ms
 ✓ test/beginner-ui.test.ts (12 tests) 8ms
 ✓ test/retry-budget.test.ts (4 tests) 4ms
 ✓ test/property/setup.test.ts (3 tests) 11ms
 ✓ test/ui-ansi.test.ts (2 tests) 2ms
 ✓ test/ui-runtime.test.ts (3 tests) 2ms
 ✓ test/storage.test.ts (94 tests) 1386ms
       ✓ returns migrated data even when save fails (line 422-423 coverage)  376ms
       ✓ throws after 5 failed EPERM retries  502ms
 ✓ test/request-transformer.test.ts (153 tests) 6049ms

 Test Files  59 passed (59)
      Tests  1792 passed (1792)
   Start at  11:25:42
   Duration  7.39s (transform 8.12s, setup 0ms, import 12.38s, tests 11.97s, environment 8ms)

 % Coverage report from v8
-------------------|---------|----------|---------|---------|-------------------
File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
-------------------|---------|----------|---------|---------|-------------------
All files          |    89.5 |    81.81 |   95.76 |   91.68 |                   
 lib               |   88.44 |    79.28 |   94.96 |   90.12 |                   
  accounts.ts      |    68.8 |    60.54 |    87.3 |   72.53 | ...38-851,901,922 
  audit.ts         |   96.62 |    97.67 |     100 |   97.53 | 19-20             
  ...rate-limit.ts |     100 |      100 |     100 |     100 |                   
  ...te-checker.ts |   92.75 |       90 |    90.9 |   93.54 | 31,41,52,152      
  ...it-breaker.ts |     100 |    96.42 |     100 |     100 | 137               
  cli.ts           |   69.16 |    66.66 |    87.5 |   72.11 | 95-100,143-183    
  config.ts        |   94.52 |    89.71 |   95.34 |   96.89 | 85,165,445-453    
  constants.ts     |     100 |      100 |     100 |     100 |                   
  ...t-overflow.ts |     100 |      100 |     100 |     100 |                   
  errors.ts        |     100 |    94.44 |     100 |     100 | 44                
  health.ts        |     100 |      100 |     100 |     100 |                   
  logger.ts        |    99.5 |    97.32 |     100 |     100 | 70,241,368        
  ...llel-probe.ts |   98.27 |       92 |     100 |     100 | 43,64             
  ...ve-refresh.ts |     100 |       96 |     100 |     100 | 158               
  recovery.ts      |     100 |    89.43 |   96.15 |     100 | ...67,399-403,406 
  refresh-queue.ts |     100 |    96.77 |     100 |     100 | 270               
  rotation.ts      |     100 |    95.65 |     100 |     100 | 245,326,357       
  schemas.ts       |     100 |      100 |     100 |     100 |                   
  shutdown.ts      |     100 |      100 |     100 |     100 |                   
  storage.ts       |   84.21 |    73.14 |   89.47 |      86 | ...1199-1201,1288 
  ...-formatter.ts |     100 |      100 |     100 |     100 |                   
  utils.ts         |     100 |      100 |     100 |     100 |                   
 lib/accounts      |   97.29 |    94.28 |     100 |   96.87 |                   
  rate-limits.ts   |   97.29 |    94.28 |     100 |   96.87 | 51                
 lib/auth          |   97.66 |    95.63 |   98.07 |     100 |                   
  auth.ts          |   98.83 |    94.82 |    87.5 |     100 | 38,62,122         
  browser.ts       |   96.66 |    93.75 |     100 |     100 | 23                
  server.ts        |   98.27 |       75 |     100 |     100 | 21,46-70,92       
  token-utils.ts   |   97.15 |     97.4 |     100 |     100 | ...47,255,374,385 
 lib/prompts       |   90.69 |    82.14 |   87.09 |    92.8 |                   
  ...ode-bridge.ts |      90 |    66.66 |     100 |     100 | 86-87             
  codex.ts         |   91.17 |    82.14 |   84.61 |   92.53 | ...54-262,399-402 
  ...code-codex.ts |   90.19 |       84 |   86.66 |   91.83 | ...96,235,261-262 
 lib/recovery      |   96.88 |    91.81 |     100 |     100 |                   
  constants.ts     |     100 |      100 |     100 |     100 |                   
  storage.ts       |   96.74 |    91.34 |     100 |     100 | ...23-230,322,345 
 lib/request       |   90.36 |    84.45 |   95.95 |   94.35 |                   
  fetch-helpers.ts |   91.84 |    81.37 |   93.75 |   95.03 | ...82,795,806,816 
  ...it-backoff.ts |     100 |      100 |     100 |     100 |                   
  ...ransformer.ts |   86.96 |    85.18 |   97.36 |   92.95 | ...90,723,943,946 
  ...se-handler.ts |    95.2 |    86.88 |   92.85 |   95.61 | 61,78,128-132,180 
  retry-budget.ts  |   91.17 |    83.33 |     100 |    93.1 | 99-100            
 ...equest/helpers |   99.01 |    96.34 |     100 |   98.93 |                   
  input-utils.ts   |   99.24 |    94.89 |     100 |   99.19 | 42                
  model-map.ts     |      90 |      100 |     100 |      90 | 137               
  tool-utils.ts    |     100 |    98.38 |     100 |     100 | 137               
 lib/storage       |     100 |     87.5 |     100 |     100 |                   
  migrations.ts    |     100 |      100 |     100 |     100 |                   
  paths.ts         |     100 |    84.61 |     100 |     100 | 26-34,75-80       
 lib/ui            |   77.46 |    64.56 |   98.11 |   79.86 |                   
  ansi.ts          |     100 |      100 |     100 |     100 |                   
  auth-menu.ts     |   56.32 |    35.86 |     100 |   61.64 | ...82-183,227-228 
  beginner.ts      |   87.65 |     84.7 |     100 |   87.67 | ...53,293,299,302 
  confirm.ts       |     100 |      100 |     100 |     100 |                   
  format.ts        |      80 |    81.25 |     100 |   84.21 | 60-62             
  runtime.ts       |     100 |    83.33 |     100 |     100 | 30                
  select.ts        |   77.07 |    62.14 |   94.44 |   79.58 | ...83,388-389,394 
  theme.ts         |   95.23 |     62.5 |     100 |   94.11 | 42                
 scripts           |   89.47 |    54.54 |     100 |   94.44 |                   
  ...th-success.js |   89.47 |    54.54 |     100 |   94.44 | 36                
-------------------|---------|----------|---------|---------|-------------------
