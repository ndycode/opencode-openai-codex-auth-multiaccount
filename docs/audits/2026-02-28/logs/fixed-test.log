
> oc-chatgpt-multi-auth@5.4.0 test
> vitest run


 RUN  v4.0.18 C:/Users/neil/DevTools/oc-chatgpt-multi-auth-audit-20260228-111254

 ✓ test/copy-oauth-success.test.ts (2 tests) 49ms
 ✓ test/auto-update-checker.test.ts (18 tests) 115ms
 ✓ test/shutdown.test.ts (11 tests) 68ms
 ✓ test/opencode-codex.test.ts (13 tests) 115ms
 ✓ test/server.unit.test.ts (13 tests) 57ms
 ✓ test/recovery-storage.test.ts (45 tests) 167ms
 ✓ test/oauth-server.integration.test.ts (5 tests) 57ms
stdout | test/logger.test.ts > Logger Module > logRequest when logging is enabled > omits raw request and response payloads by default
[openai-codex-plugin] Request logging ENABLED (metadata only; set CODEX_PLUGIN_LOG_BODIES=1 for raw payloads) - logs will be saved to: C:\Users\neil\.opencode\logs\codex-plugin

 ✓ test/response-handler.test.ts (30 tests) 64ms
stdout | test/logger.test.ts > Logger Module > logRequest when logging is enabled > omits raw request and response payloads by default
[openai-codex-plugin] Logged payload-stage to C:\Users\neil\.opencode\logs\codex-plugin\request-1-payload-stage.json

stdout | test/logger.test.ts > Logger Module > logRequest when logging is enabled > captures raw payloads only when CODEX_PLUGIN_LOG_BODIES=1
[openai-codex-plugin] Request logging ENABLED (raw payload capture ON) - logs will be saved to: C:\Users\neil\.opencode\logs\codex-plugin

stdout | test/logger.test.ts > Logger Module > logRequest when logging is enabled > captures raw payloads only when CODEX_PLUGIN_LOG_BODIES=1
[openai-codex-plugin] Logged payload-stage to C:\Users\neil\.opencode\logs\codex-plugin\request-1-payload-stage.json

stdout | test/logger.test.ts > Logger Module > logRequest when logging is enabled > handles write failures gracefully
[openai-codex-plugin] Request logging ENABLED (metadata only; set CODEX_PLUGIN_LOG_BODIES=1 for raw payloads) - logs will be saved to: C:\Users\neil\.opencode\logs\codex-plugin

 ✓ test/logger.test.ts (85 tests) 65ms
 ✓ test/audit.test.ts (17 tests) 95ms
 ✓ test/audit.race.test.ts (1 test) 146ms
 ✓ test/property/rotation.property.test.ts (16 tests) 120ms
 ✓ test/cli.test.ts (38 tests) 404ms
       ✓ returns true for 'y' input  358ms
 ✓ test/storage-async.test.ts (23 tests) 68ms
 ✓ test/rotation.test.ts (43 tests) 25ms
 ✓ test/property/transformer.property.test.ts (17 tests) 58ms
 ✓ test/parallel-probe.test.ts (15 tests) 243ms
 ✓ test/utils.test.ts (24 tests) 21ms
 ✓ test/chaos/fault-injection.test.ts (43 tests) 58ms
 ✓ test/context-overflow.test.ts (21 tests) 24ms
 ✓ test/rotation-integration.test.ts (21 tests) 38ms
 ✓ test/recovery.test.ts (73 tests) 35ms
 ✓ test/circuit-breaker.test.ts (23 tests) 12ms
 ✓ test/input-utils.test.ts (32 tests) 22ms
 ✓ test/token-utils.test.ts (90 tests) 18ms
 ✓ test/codex-prompts.test.ts (28 tests) 15ms
 ✓ test/plugin-config.test.ts (61 tests) 23ms
 ✓ test/schemas.test.ts (60 tests) 22ms
 ✓ test/index-retry.test.ts (1 test) 718ms
     ✓ waits and retries when all accounts are rate-limited  717ms
 ✓ test/paths.test.ts (28 tests) 10ms
 ✓ test/errors.test.ts (33 tests) 10ms
 ✓ test/proactive-refresh.test.ts (27 tests) 15ms
 ✓ test/refresh-queue.test.ts (24 tests) 12ms
stdout | test/index.test.ts > OpenAIOAuthPlugin persistAccountPool > preserves flagged organization identity during verify-flagged restore for cached and refreshed paths

Verifying flagged accounts...


stdout | test/index.test.ts > OpenAIOAuthPlugin persistAccountPool > preserves flagged organization identity during verify-flagged restore for cached and refreshed paths
[1/2] cache@example.com: RESTORED (Codex CLI cache)

stdout | test/index.test.ts > OpenAIOAuthPlugin persistAccountPool > preserves flagged organization identity during verify-flagged restore for cached and refreshed paths
[2/2] refresh@example.com: RESTORED

stdout | test/index.test.ts > OpenAIOAuthPlugin persistAccountPool > preserves flagged organization identity during verify-flagged restore for cached and refreshed paths

Results: 2 restored, 0 still flagged


 ✓ test/accounts.test.ts (99 tests) 25ms
 ✓ test/index.test.ts (106 tests) 781ms
       ✓ exports event handler  682ms
 ✓ test/rate-limit-backoff.test.ts (21 tests) 12ms
 ✓ test/auth-rate-limit.test.ts (22 tests) 11ms
 ✓ test/browser.test.ts (21 tests) 11ms
 ✓ test/auth.test.ts (42 tests) 24ms
 ✓ test/recovery-constants.test.ts (7 tests) 8ms
 ✓ test/tool-utils.test.ts (30 tests) 7ms
 ✓ test/health.test.ts (13 tests) 9ms
 ✓ test/ui-select.test.ts (6 tests) 12ms
 ✓ test/auth-menu.test.ts (2 tests) 7ms
 ✓ test/model-map.test.ts (22 tests) 6ms
 ✓ test/ui-theme.test.ts (5 tests) 4ms
 ✓ test/codex.test.ts (32 tests) 4ms
 ✓ test/beginner-ui.test.ts (12 tests) 3ms
 ✓ test/config.test.ts (20 tests) 5ms
 ✓ test/table-formatter.test.ts (8 tests) 4ms
 ✓ test/property/setup.test.ts (3 tests) 8ms
 ✓ test/ui-confirm.test.ts (3 tests) 3ms
 ✓ test/retry-budget.test.ts (4 tests) 2ms
 ✓ test/ui-format.test.ts (4 tests) 2ms
 ✓ test/ui-runtime.test.ts (3 tests) 2ms
 ✓ test/ui-ansi.test.ts (2 tests) 2ms
 ✓ test/storage.test.ts (94 tests) 1319ms
       ✓ returns migrated data even when save fails (line 422-423 coverage)  363ms
       ✓ throws after 5 failed EPERM retries  497ms
 ✓ test/fetch-helpers.test.ts (77 tests) 2235ms
       ✓ transforms request when parsedBody is provided even if init.body is not a string  2191ms
 ✓ test/request-transformer.test.ts (153 tests) 8401ms
       ✓ preserves existing prompt_cache_key passed by host (OpenCode)  2323ms

 Test Files  59 passed (59)
      Tests  1792 passed (1792)
   Start at  11:25:27
   Duration  9.20s (transform 7.47s, setup 0ms, import 11.74s, tests 15.87s, environment 7ms)

